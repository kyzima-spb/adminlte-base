{% import "adminlte_full/macros/bootstrap4.html" as bootstrap %}


{% macro render_card_wrapper(content=none,
                             card_id='',
                             color='',
                             bg_color='',
                             outline=false,
                             card_class='') %}
  <div class="card card-{{ color }} bg-{{ bg_color }}{% if outline %} card-outline{% endif %} {{ card_class }}" id="{{ card_id }}">
    {% if content is none %}{{ caller() }}{% else %}{{ content }}{% endif %}
  </div>
{% endmacro %}


{% macro render_card_tools(maximizable=false,
                           collapsable=false,
                           expandable=false,
                           closable=false,
                           data_source=none,
                           refreshable_options='') %}
  <div class="card-tools">
    {% if data_source %}
      <button type="button" class="btn btn-tool" data-card-widget="card-refresh" data-source="{{ data_source }}" {{ refreshable_options | safe }}>
        <i class="fas fa-sync-alt"></i>
      </button>
    {% endif %}
    {% if maximizable %}
      <button type="button" class="btn btn-tool" data-card-widget="maximize"><i class="fas fa-expand"></i></button>
    {% endif %}
    {% if collapsable or expandable %}
      <button type="button" class="btn btn-tool" data-card-widget="collapse">
        <i class="fas {% if expandable %}fa-plus{% else %}fa-minus{% endif %}"></i>
      </button>
    {% endif %}
    {% if closable %}
      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
    {% endif %}
  </div>
{% endmacro %}


{% macro render_card(title='',
                     content=none,
                     card_id='',
                     color='',
                     bg_color='',
                     outline=false,
                     card_class='',
                     maximizable=false,
                     collapsable=false,
                     expandable=false,
                     closable=false,
                     data_source=none,
                     refreshable_options='') %}
  {% if expandable %}
    {% set card_class = card_class + ' collapsed-card' %}
  {% endif %}

  {% if content is none %}
    {% set content = caller() %}
  {% endif %}

  {% call render_card_wrapper(card_id=card_id, color=color, bg_color=bg_color, outline=outline, card_class=card_class) %}
    <div class="card-header">
      <h3 class="card-title">{{ title }}</h3>
      {{ render_card_tools(maximizable=maximizable,
                           collapsable=collapsable,
                           expandable=expandable,
                           closable=closable,
                           data_source=data_source,
                           refreshable_options=refreshable_options)
      }}
    </div>
    {{ content }}
  {% endcall %}
{% endmacro %}


{% macro render_table(data, headers=none, footer=false, auto_number=false, table_id='', table_class='') %}
  {% set table_header %}
    {% if headers %}
      <tr>
        {% if auto_number %}<th style="width: 1em">#</th>{% endif %}
        {% if headers is mapping %}
          <th>{{ headers.values() | join('</th><th>' | safe) }}</th>
        {% else %}
          <th>{{ headers | join('</th><th>' | safe) }}</th>
        {% endif %}
      </tr>
    {% endif %}
  {% endset %}
  <table id="{{ table_id }}" class="table {{ table_class }}">
    <thead>{{ table_header }}</thead>
    <tbody>
      {% for row in data %}
        <tr>
          {% if auto_number %}<td>{{ loop.index }}</td>{% endif %}
          {{ caller(row) }}
        </tr>
      {% endfor %}
    </tbody>
    {% if footer %}<tfoot>{{ table_header }}</tfoot>{% endif %}
  </table>
{% endmacro %}


{% macro render_data_table(data, headers=none, footer=false, auto_number=false, table_id='', table_class='') %}
  {% call(row) render_table(data=data, headers=headers, footer=footer, auto_number=auto_number, table_id=table_id, table_class=table_class) %}
    {% if headers is mapping %}
      {% for col in headers %}
        <td>{{ row[col] }}</td>
      {% endfor %}
    {% else %}
      {% for col in row %}
        <td>{{ col }}</td>
      {% endfor %}
    {% endif %}
  {% endcall %}
{% endmacro %}